{% extends 'layout.jinja2' %}

{% block title %} Results {% endblock %}

{% block styles %}
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/results.css') }}" />
{% endblock %}

{% block content %}
<script>
    var analysis_id = {{analysis_id | safe }};
</script>
<div class='container'>
    <h1>Analysis Results</h1>
    <p>Analysis was run by {{config["analyst"]}} on DATE</p>
    <h2>Introduction</h2>
    <p>This is a report generated by the TransitCenter Equity Scenario Comparison Application (TESCA), which conducts a
        comparative analysis of access to opportunties across different population groups in a specified region.
    </p>
    <p>{{config["description"]}}</p>
    <p>
        We use two types of measures:
    <ul>
        <li>
            <b>Cumulative measures</b>, which sum the total number of a given destination or opportunity reachable in a
            specified timeframe. With this metric, <b>higher is typically better</b>. When viewing these measures, the
            accompanying parameter indicates the maximum travel time within which a desination is considered reachable.
            For example, a parameter of 45 indicates that the measure counts all destinations within 45 minutes as
            reachable.
        </li>
        <li>
            <b>Travel time measures</b>, which measure how long it takes to reach the nth (e.g. 1st, 3rd, etc) closest
            destination. With this metric, <b>lower is typically better</b>. When viewing these measures, the
            accompanying parameter indicates which nth closest desination was used. For example, a parameter of '2'
            indicates that the measure counts the travel time to the 2nd closest destination.
        </li>
    </ul>
    </p>
    <div class="pure-g">
        <div class="pure-u-1">
            <h2>Analysis Details</h2>
            <p>This analysis compares the following two scenarios:</p>
            <ol>
                {% for scenario in config["scenarios"] %}
                <li>
                    <p><b>{{ scenario["name"] }}</b>: {{ scenario["description"] }}</p>
                    <p>The analysis was run at {{ scenario["start_datetime"] }} and results are averaged over trips made
                        in the subsequent {{ scenario["duration"] }} minutes.
                        {% if "TRANSIT" in scenario["transit_modes"] %}
                        All modes of transit were considered in addition to walking.
                        {% else %}
                        In addition to walking, the following modes of transit were considered: {{
                        ", ".join(scenario["transit_modes"])| lower}}.
                        {% endif %}
                    </p>
                </li>
                {% endfor %}
            </ol>
        </div>
    </div>
    <div class="pure-g">
        <div class="pure-u-1">
            <div id="summary-map" class="svg-container"></div>
            <h2>Scenario Comparisons</h2>
            <p>In this section, we compare the two sencarios analyzed. </p>
            {% for key, value in config['opportunities'].items() %}
            <h3>{{ config['opportunities'][key]['name'] }}</h3>
            <p>{{ config['opportunities'][key]['description'] }}</p>
            {% if config['opportunities'][key]['method'] == 'cumulative' %}
            <p>Here are the weighted average results of access to {{ config['opportunities'][key]['name'].lower() }}
                compared across various demographic groups. Keep in mind that this is a cumulative measure, where
                <b>higher</b> values are typically better.
            </p>
            {% else %}
            <p>Here are the results of access to {{ config['opportunities'][key]['name'].lower() }} compared across
                various demographic groups. Keep in mind that this is a travel time measure, where <b>lower</b> values
                are typically better.</p>
            {% endif %}
            {% for parameter in config['opportunities'][key]['parameters'] %}
            <div class="pure-u-1">
                {% if config['opportunities'][key]['method'] == 'cumulative' %}
                <div id="{{ key }}_c{{ parameter }}" class="result-chart"></div>
                {% else %}
                <div id="{{ key }}_t{{ parameter }}" class="result-chart"></div>
                {% endif %}
            </div>
            {% endfor %}
            {% endfor %}
        </div>
    </div>
    <div id="summary-chart" class="svg-container"></div>
    <h2>Notes</h2>
    <p>Things that could go here:
    <ul>
        <li>Any relevant papers or documentation?</li>
        <li>Detailed methodology outline?</li>
        <li>Other specific things to note</li>
    </ul>
    </p>
</div>
<script src="https://d3js.org/d3.v6.js" defer></script>
<script src="https://d3js.org/d3-array.v2.min.js" defer></script>
<script src="{{ url_for('static', filename='js/results.js') }}" defer></script>
{% endblock %}